/*! wicker.js modules - 2014-10-31
 * (c) 2014 Wicker Wings
 * License: MIT
 ****/
!function(a){"use strict";function b(){if(a.XMLHttpRequest)return new XMLHttpRequest;if(a.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(b){return null}return null}function c(a,f,g,h){var k,m,o={};if(!i(a))return c(a.url,a);if(arguments.length<4&&j(g)&&(h=g,g={}),g=l(g),k=b(),!k)return null;o.xhr=k,o.url=a,o.thisContext=g.context||k,o[200]=o[304]=h||g.success||g.callback||g[200]||g[304],o.failure=g.failure||n,o.progress=g.progress||n,k.onreadystatechange=function(){e(o.thisContext,o)},g.progress&&k.addEventListener("progress",function(a){d(g.context,o,a)}),k.open(g.method,a,g.async,g.user,g.password);var p=g.headers;if(j(k.setRequestHeader)){k.setRequestHeader("Conent-Type",g.enctype);for(m in p)k.setRequestHeader(m,p[m])}return g.mimetype&&k.overrideMimeType(g.mimetype),k.send(g.postData),g.async||e(o.thisContext,o),o}function d(a,b){b.progress.call(a,b)}function e(a,b){var c=b.xhr;4===c.readyState&&(0===c.status?b[200].call(a,c,b):b[c.status]?b[c.status].call(a,c,b):200!==c.status&&b.failure.call(a,c,b))}function f(a){return"undefined"==typeof a}function g(a){return"null"==typeof a}function h(a){return!f(a)&&!g(a)}function i(a){return"string"==typeof a}function j(a){return"function"==typeof a}function k(a){return h(a)&&h(a.length)}function l(a){if(a||(a={}),a.method=a.method||"GET",a.postData=a.postData||"",a.async=h(a.async)?a.async:!0,a.user=a.user||"",a.password=a.password||"",a.enctype=a.enctype||"",a.headers=a.headers||[],a.enctype=a.enctype||"applecation/x-www-form-urlencoded",a.method=a.method.toUpperCase(),"GET"!==a.method&&"POST"!==a.method&&"HEAD"!==a.method)throw new Error("This ajax library does not support this method: "+a.method);return a.postData=m(a.postData),a}function m(a,b){var c,d=[],e="?";b=b?encodeURIComponent(b)+"[]":"";var f=function(a,b){i(b)?d.push(a+"="+encodeURIComponent(b)):(b.name||b.value)&&b.name&&b.value&&d.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))};if(i(a))return e+encodeURIComponent(a);if(k(a))for(c=0;c<a.length;c++)f(b?b:c,a[c]);else for(c in a)f(c,a[c]);return e+d.join("&")}function n(){}var o="ajax 0.2",p={version:o,ajax:c,serialize:m};"object"==typeof module&&"object"==typeof module.exports?module.exports=p:a.wicker&&"function"==typeof a.wicker.factory?a.wicker.factory("ajax",function(){return p}):"function"==typeof define&&define.amd?define("ajax",function(){return p}):"object"==typeof a&&"object"==typeof a.document&&(a.dab=a.dab||{},a.dab.ajax=p)}(this),function(a){"use strict";function b(a,b,c){this.id=a,this.canvas=null,this.spriteImg=null,this.spriteImgURL=n(c,b.src),this.spriteData=b,this.initialize()}function c(a){return document.createElement(a)}function d(a){j||(j={}),a=a||m.spriteDataURL,a&&i.ajax(a,"",{success:f,failure:e})}function e(a){throw wicker.factory("sprite"),new Error("load failure "+a.status)}function f(a,c){var d,e=JSON.parse(a.responseText);for(d in e)j[d]=new b(d,e[d],c.url),j[d].load()}function g(a){var b,c=!0;j[a].loaded=!0,j[a].create();for(b in j)c=c&&j[b].loaded;c&&wicker.factory("sprite")}function h(a,b,c,d){var e=j[a];return e?e.getSprite(b,c,d):null}var i,j,k,l="Sprite 0.4.1",m={};b.prototype={constructor:b,initialize:function(){this.canvas=c("canvas"),this.spriteImg=c("img")},load:function(){var a=this.id;this.spriteImg.onload=function(){g(a)},this.spriteImg.src=this.spriteImgURL},create:function(){var a=this.canvas;a.width=this.spriteImg.width,a.height=this.spriteImg.height,a.getContext("2d").drawImage(this.spriteImg,0,0)},getSprite:function(a,b,d){var e,f,g=this.spriteData[a],h=b&&!d?b.width:0,i=b&&!d?b.height:0;return h&&i||(h=g.w,i=g.h),d?f=b:(b=b||c("img"),e=b.getContext?b:c("canvas"),f=e.getContext("2d"),b.width=e.width=h,b.height=e.height=i),f.drawImage(this.canvas,g.x,g.y,g.w,g.h,0,0,h,i),d||b.getContext||(b.src=e.toDataURL(),e=null),b}};var n=function(a,b){var c,d=a.split("/"),e=b.split("/");if(c=b.indexOf("://"),-1!==c)return 0===c?location.protocol.replace(/:$/,"")+b:b;if(0===b.indexOf("/"))return a.match(/(^.+:\/\/[^/]*)/)[1]+b;for(d.pop(),c=0;c<e.length;c++)".."===e[c]?d.pop():"."!==e[c]&&d.push(e[c]);return d.join("/")};k={version:l,load:d,getSprite:h},a.wicker?(wicker.carriage("ajax.js","module:"),wicker.factory("sprite",["ajax"],function(a){return m=this,i=a,j?k:(d(),!1)})):"object"==typeof a&&"object"==typeof a.document&&(i=a.dab.ajax,a.dab.sprite=k)}(this);